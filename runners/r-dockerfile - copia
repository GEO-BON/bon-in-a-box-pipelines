FROM rocker/geospatial:dev-osgeo

# Function to check if a package is installed
RUN R -e "check_and_install <- function(pkg) { if (!requireNamespace(pkg, quietly = TRUE)) install.packages(pkg) }"

# Additional R packages
RUN R -e 'packages <- c(
  "AICcmodavg", "auk", "CoordinateCleaner", "data.table", "devtools", "dggridR", "dismo", 
  "dplyr", "dotenv", "EBirdST", "ENMeval", "fasterize", "fields", "gdalUtilities", "geodata", 
  "ggplot2", "ggpubr", "ggsci", "gridExtra", "janitor", "jsonlite", "landscapemetrics", 
  "lubridate", "magrittr", "MuMIn", "OpenStreetMap", "pbapply", "plyr", "raster", "rjson", 
  "rgdal", "rredlist", "rstac", "rstudioapi", "sf", "sp", "stars", "stringr", "terra", 
  "this.path", "tibble", "tidyverse", "tools", "unmarked", "units", "vapour", "yaml"); 
  sapply(packages, function(pkg) { cat("Installing", pkg, "\n"); check_and_install(pkg) })'

# Install GitHub packages if they are not already installed
RUN R -e 'if (!requireNamespace("gdalcubes", quietly = TRUE)) { cat("Installing gdalcubes\n"); devtools::install_github("appelmar/gdalcubes_R") }'
RUN R -e 'if (!requireNamespace("stacatalogue", quietly = TRUE)) { cat("Installing stacatalogue\n"); devtools::install_github("ReseauBiodiversiteQuebec/stac-catalogue") }'
RUN R -e 'if (!requireNamespace("gdalUtils", quietly = TRUE)) { cat("Installing gdalUtils\n"); devtools::install_github("gearslaboratory/gdalUtils") }'

# Add date to version.txt
RUN date +"%Y-%m-%d %R" > /version.txt
