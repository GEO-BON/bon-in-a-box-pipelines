{
  "nodes": [
    {
      "id": "34",
      "type": "io",
      "position": {
        "x": 1372,
        "y": 231.5
      },
      "data": {
        "descriptionFile": "filtering>cleanCoordinates.yml"
      }
    },
    {
      "id": "35",
      "type": "constant",
      "position": {
        "x": 950,
        "y": 221.5
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text[]",
        "value": [
          "equal",
          "zeros",
          "duplicates",
          "same_pixel",
          "capitals",
          "centroids",
          "gbif",
          "institutions"
        ]
      }
    },
    {
      "id": "64",
      "type": "constant",
      "position": {
        "x": 956,
        "y": 331.5
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "float",
        "value": 0.8
      }
    },
    {
      "id": "121",
      "type": "userInput",
      "position": {
        "x": 250,
        "y": 43
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text[]",
        "value": [
          "Acer saccharum"
        ]
      }
    },
    {
      "id": "123",
      "type": "output",
      "position": {
        "x": 1893,
        "y": 305.5
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "126",
      "type": "output",
      "position": {
        "x": 1372,
        "y": 126.5
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "128",
      "type": "userInput",
      "position": {
        "x": 171,
        "y": 454
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "float",
        "value": 1000
      }
    },
    {
      "id": "137",
      "type": "userInput",
      "position": {
        "x": 106,
        "y": 235.16666666666669
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text[]",
        "value": [
          "chelsa-clim|bio1",
          "chelsa-clim|bio2"
        ]
      }
    },
    {
      "id": "146",
      "type": "userInput",
      "position": {
        "x": 77,
        "y": 396.1666666666667
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text",
        "value": "https://stac.geobon.org/"
      }
    },
    {
      "id": "149",
      "type": "output",
      "position": {
        "x": 611,
        "y": 12
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "159",
      "type": "io",
      "position": {
        "x": 611,
        "y": 59
      },
      "data": {
        "descriptionFile": "data>getGBIFObservations>getGBIFObservations.yml"
      }
    },
    {
      "id": "160",
      "type": "io",
      "position": {
        "x": 922,
        "y": 382.5
      },
      "data": {
        "descriptionFile": "data>loadFromStac.yml"
      }
    },
    {
      "id": "161",
      "type": "io",
      "position": {
        "x": 922,
        "y": 565.5
      },
      "data": {
        "descriptionFile": "data>loadFromStac.yml"
      }
    },
    {
      "id": "162",
      "type": "output",
      "position": {
        "x": 1372,
        "y": 184.5
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "163",
      "type": "constant",
      "position": {
        "x": 70,
        "y": 488
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "options",
        "value": "near",
        "options": [
          "near",
          "bilinear",
          "average",
          "mode",
          "cubic",
          "cubicspline",
          "lanczos",
          "rms",
          "min",
          "max",
          "sum",
          "med",
          "q1",
          "q3"
        ]
      }
    },
    {
      "id": "164",
      "type": "constant",
      "position": {
        "x": 70,
        "y": 534
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "options",
        "value": "first",
        "options": [
          "first",
          "min",
          "max",
          "mean",
          "median"
        ]
      }
    },
    {
      "id": "166",
      "type": "userInput",
      "position": {
        "x": 92,
        "y": 589
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text[]",
        "value": [
          "esacci-lc|esacci-lc-2020"
        ]
      }
    },
    {
      "id": "167",
      "type": "userInput",
      "position": {
        "x": 12,
        "y": 621
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "application/geopackage+sqlite3"
      }
    },
    {
      "id": "169",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 269.1666666666667
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "170",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 310.1666666666667
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text",
        "value": null
      }
    },
    {
      "id": "171",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 351.1666666666667
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "174",
      "type": "userInput",
      "position": {
        "x": 126,
        "y": 163.89999999999998
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "bboxCRS"
      }
    },
    {
      "id": "176",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 655
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "177",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 696
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "178",
      "type": "constant",
      "position": {
        "x": 100,
        "y": 737
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "179",
      "type": "io",
      "position": {
        "x": 1893,
        "y": 352.5
      },
      "data": {
        "descriptionFile": "SDM>BRT>fitBRT.yml"
      }
    },
    {
      "id": "180",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 601
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "181",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 648
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "182",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 695
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "183",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 507
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "184",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 554
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "185",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 742
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "186",
      "type": "output",
      "position": {
        "x": 2264,
        "y": 789
      },
      "data": {
        "label": "Output"
      }
    }
  ],
  "edges": [
    {
      "source": "35",
      "sourceHandle": null,
      "target": "34",
      "targetHandle": "tests",
      "id": "reactflow__edge-35-34tests"
    },
    {
      "source": "64",
      "sourceHandle": null,
      "target": "34",
      "targetHandle": "env_threshold",
      "id": "reactflow__edge-64-34env_threshold"
    },
    {
      "source": "34",
      "sourceHandle": "clean_presence",
      "target": "123",
      "targetHandle": null,
      "id": "reactflow__edge-34clean_presence-123"
    },
    {
      "source": "121",
      "sourceHandle": null,
      "target": "149",
      "targetHandle": null,
      "id": "reactflow__edge-121-149"
    },
    {
      "source": "121",
      "sourceHandle": null,
      "target": "159",
      "targetHandle": "taxa",
      "id": "reactflow__edge-121-159taxa"
    },
    {
      "source": "159",
      "sourceHandle": "gbif_doi",
      "target": "126",
      "targetHandle": null,
      "id": "reactflow__edge-159gbif_doi-126"
    },
    {
      "source": "159",
      "sourceHandle": "observations_file",
      "target": "34",
      "targetHandle": "presence",
      "id": "reactflow__edge-159observations_file-34presence"
    },
    {
      "source": "160",
      "sourceHandle": "rasters",
      "target": "34",
      "targetHandle": "predictors",
      "id": "reactflow__edge-160rasters-34predictors"
    },
    {
      "source": "160",
      "sourceHandle": "rasters",
      "target": "162",
      "targetHandle": null,
      "id": "reactflow__edge-160rasters-162"
    },
    {
      "source": "146",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "stac_url",
      "id": "reactflow__edge-146-160stac_url"
    },
    {
      "source": "146",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "stac_url",
      "id": "reactflow__edge-146-161stac_url"
    },
    {
      "source": "137",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "collections_items",
      "id": "reactflow__edge-137-160collections_items"
    },
    {
      "source": "163",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "resampling",
      "id": "reactflow__edge-163-160resampling"
    },
    {
      "source": "164",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "aggregation",
      "id": "reactflow__edge-164-160aggregation"
    },
    {
      "source": "128",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "spatial_res",
      "id": "reactflow__edge-128-160spatial_res"
    },
    {
      "source": "128",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "spatial_res",
      "id": "reactflow__edge-128-161spatial_res"
    },
    {
      "source": "166",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "collections_items",
      "id": "reactflow__edge-166-161collections_items"
    },
    {
      "source": "164",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "aggregation",
      "id": "reactflow__edge-164-161aggregation"
    },
    {
      "source": "163",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "resampling",
      "id": "reactflow__edge-163-161resampling"
    },
    {
      "source": "167",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "study_area",
      "id": "reactflow__edge-167-160study_area"
    },
    {
      "source": "167",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "study_area",
      "id": "reactflow__edge-167-161study_area"
    },
    {
      "source": "169",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "t0",
      "id": "reactflow__edge-169-160t0"
    },
    {
      "source": "170",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "t1",
      "id": "reactflow__edge-170-160t1"
    },
    {
      "source": "171",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "temporal_res",
      "id": "reactflow__edge-171-160temporal_res"
    },
    {
      "source": "174",
      "sourceHandle": null,
      "target": "159",
      "targetHandle": "bbox_crs",
      "id": "reactflow__edge-174-159bbox_crs"
    },
    {
      "source": "174",
      "sourceHandle": null,
      "target": "160",
      "targetHandle": "bbox_crs",
      "id": "reactflow__edge-174-160bbox_crs"
    },
    {
      "source": "174",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "bbox_crs",
      "id": "reactflow__edge-174-161bbox_crs"
    },
    {
      "source": "176",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "t0",
      "id": "reactflow__edge-176-161t0"
    },
    {
      "source": "177",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "t1",
      "id": "reactflow__edge-177-161t1"
    },
    {
      "source": "178",
      "sourceHandle": null,
      "target": "161",
      "targetHandle": "temporal_res",
      "id": "reactflow__edge-178-161temporal_res"
    },
    {
      "source": "161",
      "sourceHandle": "rasters",
      "target": "179",
      "targetHandle": "water_mask",
      "id": "reactflow__edge-161rasters-179water_mask"
    },
    {
      "source": "160",
      "sourceHandle": "rasters",
      "target": "179",
      "targetHandle": "predictors",
      "id": "reactflow__edge-160rasters-179predictors"
    },
    {
      "source": "34",
      "sourceHandle": "clean_presence",
      "target": "179",
      "targetHandle": "occurrence",
      "id": "reactflow__edge-34clean_presence-179occurrence"
    },
    {
      "source": "174",
      "sourceHandle": null,
      "target": "179",
      "targetHandle": "bbox_crs",
      "id": "reactflow__edge-174-179bbox_crs"
    },
    {
      "source": "179",
      "sourceHandle": "env_corners",
      "target": "180",
      "targetHandle": null,
      "id": "reactflow__edge-179env_corners-180"
    },
    {
      "source": "179",
      "sourceHandle": "pseudoabsences",
      "target": "181",
      "targetHandle": null,
      "id": "reactflow__edge-179pseudoabsences-181"
    },
    {
      "source": "179",
      "sourceHandle": "range",
      "target": "182",
      "targetHandle": null,
      "id": "reactflow__edge-179range-182"
    },
    {
      "source": "179",
      "sourceHandle": "range",
      "target": "183",
      "targetHandle": null,
      "id": "reactflow__edge-179range-183"
    },
    {
      "source": "179",
      "sourceHandle": "sdm_uncertainty",
      "target": "184",
      "targetHandle": null,
      "id": "reactflow__edge-179sdm_uncertainty-184"
    },
    {
      "source": "179",
      "sourceHandle": "predicted_sdm",
      "target": "185",
      "targetHandle": null,
      "id": "reactflow__edge-179predicted_sdm-185"
    },
    {
      "source": "179",
      "sourceHandle": "fit_stats",
      "target": "186",
      "targetHandle": null,
      "id": "reactflow__edge-179fit_stats-186"
    }
  ],
  "inputs": {
    "pipeline@121": {
      "label": "Species",
      "description": "Name of species",
      "type": "text[]",
      "example": [
        "Acer saccharum"
      ],
      "weight": 0
    },
    "pipeline@174": {
      "label": "Bounding and CRS",
      "description": "Select a bounding box and CRS",
      "type": "bboxCRS",
      "example": null,
      "weight": 1
    },
    "pipeline@146": {
      "label": "STAC URL",
      "description": "URL of the STAC catalog.",
      "type": "text",
      "example": "https://stac.geobon.org/",
      "weight": 2
    },
    "pipeline@137": {
      "label": "Environmental Predictors",
      "description": "Vector of strings, collection name followed by '|' followed by item id. View GEO BON STAC catalog items [here](https://stac.geobon.org/viewer/). The collection name and item name can be found in the URL (e.g. for \"https://stac.geobon.org/viewer/chelsa-clim/bio1\" the collection name is chelsa-clim and the item id is bio1). ",
      "type": "text[]",
      "example": [
        "chelsa-clim|bio1",
        "chelsa-clim|bio3",
        "chelsa-clim|bio4",
        "chelsa-clim|bio12",
        "chelsa-clim|bio15"
      ],
      "weight": 3
    },
    "data>getGBIFObservations>getGBIFObservations.yml@159|min_year": {
      "description": "Min year observations wanted",
      "label": "minimum year",
      "type": "int",
      "example": 2010,
      "weight": 4
    },
    "pipeline@128": {
      "label": "Spatial Resolution",
      "description": "Integer, spatial resolution of the rasters in the same units as the chosen coordinate reference system (meters or degrees)",
      "type": "float",
      "example": 0.008,
      "weight": 5
    },
    "data>getGBIFObservations>getGBIFObservations.yml@159|max_year": {
      "description": "Max year observations wanted",
      "label": "maximum year",
      "type": "int",
      "example": 2024,
      "weight": 6
    },
    "pipeline@166": {
      "label": "Land Cover Layer",
      "description": "Land cover layer in the stack to use to mask water.",
      "type": "text[]",
      "example": [
        "esacci-lc|esacci-lc-2020"
      ],
      "weight": 7
    },
    "pipeline@167": {
      "label": "Study area",
      "description": "Polygon of study area used to crop output layers",
      "type": "application/geopackage+sqlite3",
      "example": null,
      "weight": 8
    },
    "SDM>BRT>fitBRT.yml@179|water_value": {
      "description": "value used to represent water in the water mask",
      "label": "value for water in mask",
      "type": "int",
      "example": 210,
      "weight": 9
    },
    "SDM>BRT>fitBRT.yml@179|terrestrial": {
      "description": "boolean flag if the species are terrestrial",
      "label": "is terrestrial species",
      "type": "boolean",
      "example": true,
      "weight": 10
    },
    "SDM>BRT>fitBRT.yml@179|max_candidate_pseudoabsences": {
      "description": "Maximum number of candidate pseudoabsences. A larger pool of candidate points increases the chance of selecting ecologically meaningful absences, but beyond a certain threshold it offers diminishing returns and may introduce bias if it oversamples areas far outside the species’ accessible range. The ideal number is typically guided by study extent, environmental heterogeneity, and species ecology, and can be fine-tuned by testing different values to identify a level that supports stable model performance without inflating computation or noise.",
      "label": "max candidate pseudoabsences",
      "type": "int",
      "example": 100000,
      "weight": 11
    },
    "SDM>BRT>fitBRT.yml@179|num_folds": {
      "description": "Number of folds to use for k-fold crossvalidation. Increasing the number of folds in cross-validation \nfor a species distribution model generally provides a more reliable estimate of model performance by reducing variance, but it also increases computational cost",
      "label": "num crossvalidation folds",
      "type": "int",
      "example": 4,
      "weight": 12
    },
    "SDM>BRT>fitBRT.yml@179|pseudoabsence_buffer": {
      "description": "Minimum distance to a presence in kilometers. Choose a pseudoabsence buffer that is large enough to avoid placing absences in areas the species is likely to occupy, but not so large that it removes important \nenvironmental variation. The buffer distance should reflect species ecology, sampling bias, and the resolution of environmental predictors, and can be refined by testing several distances to find one that yields stable, interpretable model performance.",
      "label": "pseudoabsence buffer",
      "type": "float",
      "example": 10,
      "weight": 13
    },
    "SDM>BRT>fitBRT.yml@179|pa_proportion": {
      "description": "The number of pseudoabsences, given by the proportion of the total occurrences to use. Using more pseudoabsences can improve model discrimination by providing a stronger contrast with presence data, \nbut too many can overwhelm the presence signal or overweight poorly sampled areas.",
      "label": "Pseudoabsence proportion",
      "type": "float",
      "example": 2.4,
      "weight": 14
    }
  },
  "outputs": {
    "pipeline@121|default_output": {
      "label": "Species",
      "description": "Name of species",
      "example": [
        "Acer saccharum"
      ],
      "type": "text[]",
      "weight": 0
    },
    "filtering>cleanCoordinates.yml@34|clean_presence": {
      "description": "Occurrences from GBIF after cleaning",
      "label": "Presences",
      "type": "text/tab-separated-values",
      "weight": 1
    },
    "data>getGBIFObservations>getGBIFObservations.yml@159|gbif_doi": {
      "description": "DOI of GBIF download. Used for citing downloaded data.",
      "label": "DOI of GBIF download",
      "type": "text",
      "example": "10.15468/dl.j644h5",
      "weight": 2
    },
    "data>loadFromStac.yml@160|rasters": {
      "description": "array of output raster paths",
      "label": "Rasters",
      "type": "image/tiff;application=geotiff[]",
      "weight": 3
    },
    "SDM>BRT>fitBRT.yml@179|env_corners": {
      "description": "location of presences and pseudoabsences in environment space",
      "label": "env_corners",
      "type": "image/jpg",
      "weight": 4
    },
    "SDM>BRT>fitBRT.yml@179|pseudoabsences": {
      "description": "pseudoabsence coordinates",
      "label": "pseudoabsences",
      "type": "text/tab-separated-values",
      "weight": 5
    },
    "SDM>BRT>fitBRT.yml@179|range": {
      "description": "range map thresholded at todo",
      "label": "range",
      "type": "image/tiff;application=geotiff",
      "weight": 7
    },
    "SDM>BRT>fitBRT.yml@179|sdm_uncertainty": {
      "description": "map of relative uncertainty",
      "label": "sdm uncertainty",
      "type": "image/tiff;application=geotiff",
      "weight": 8
    },
    "SDM>BRT>fitBRT.yml@179|predicted_sdm": {
      "description": "map of predicted occurrence probability",
      "label": "predicted sdm",
      "type": "image/tiff;application=geotiff",
      "weight": 9
    },
    "SDM>BRT>fitBRT.yml@179|fit_stats": {
      "description": "JSON of model fit stats and threshold",
      "label": "fit statistics",
      "type": "text/json",
      "weight": 10
    }
  },
  "metadata": {
    "name": "Species distribution modeling with Boosted Regression Trees (BRTs)",
    "description": "\n## Introduction\nThis pipeline builds a model to predict the distribution of a species (a type of essential biodiversity variable), by using occurrence data from the Global Biodiversity Information Facility (GBIF), and environmental predictors from a STAC Catalogue.\nIn particular, this pipeline uses a specific model called a Boosted Regression Tree (BRT), a machine-learning model which tends to work well with spatial data.\n\n## Uses\nBRT species distribution models can be used as input layers for other pipelines that require species ranges (e.g. the Species Habitat Index) or stacked together to create maps of species richness. Uncertaintly layers from these SDMs can be used to prioritize sampling areas (e.g. through the occurrence sampling priority pipeline).\n\n## Pipeline limitations\n- The pipeline needs a minimum number of occurrences. If there are too few occurrences the model will not generate accurate predictions. - If there are a ton of occurrences, pseudoabsence generation will be slow. Make sure that the maximum candidate number of pseudoabsences is appropriate for the size of the input rasters. Pseudoabsences should not be too sparse compared to your occurrences. - Do not transform variables (e.g. PCA) before inputting into the pipeline. \n\n## Before you start\nA GBIF API key is needed for this analysis. Learn more [here](https://techdocs.gbif.org/en/openapi/).",
    "author": [
      {
        "name": "Michael D. Catchen",
        "identifier": "https://orcid.org/0000-0002-6506-6487",
        "role": "Pipeline development"
      }
    ],
    "lifecycle": {
      "status": "in_review"
    },
    "license": "MIT",
    "external_link": "https://github.com/GEO-BON/biab-2.0/blob/main/scripts/SDM/BRT",
    "references": [
      {
        "text": "Elith, J., Leathwick, J.R. and Hastie, T. (2008), A working guide to boosted regression trees. Journal of Animal Ecology, 77.802-813.",
        "doi": "https://doi.org/10.1111/j.1365-2656.2008.01390.x"
      },
      {
        "text": "Poisot, T.; Bussières-Fournel, A.; Dansereau, G.; Catchen, M. D. A Julia toolkit for species distribution data. Peer Community Journal, Volume 5 (2025), article no. e101.",
        "doi": "https://doi.org/10.24072/pcjournal.589"
      }
    ]
  }
}