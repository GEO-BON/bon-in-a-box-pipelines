{
  "nodes": [
    {
      "id": "0",
      "type": "io",
      "position": {
        "x": 2229,
        "y": 120
      },
      "data": {
        "descriptionFile": "site_selection_BAS>Block_creation.yml"
      }
    },
    {
      "id": "2",
      "type": "io",
      "position": {
        "x": 1624,
        "y": 258.3333333333333
      },
      "data": {
        "descriptionFile": "data>loadFromStac.yml"
      }
    },
    {
      "id": "6",
      "type": "output",
      "position": {
        "x": 2827,
        "y": 278
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "13",
      "type": "output",
      "position": {
        "x": 2827,
        "y": 12
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "14",
      "type": "output",
      "position": {
        "x": 2827,
        "y": 230
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "26",
      "type": "io",
      "position": {
        "x": 2827,
        "y": 70
      },
      "data": {
        "descriptionFile": "site_selection_BAS>BAS_algorithm.yml"
      }
    },
    {
      "id": "29",
      "type": "output",
      "position": {
        "x": 3294,
        "y": 201
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "31",
      "type": "output",
      "position": {
        "x": 3294,
        "y": 41
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "32",
      "type": "output",
      "position": {
        "x": 3294,
        "y": 153
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "45",
      "type": "io",
      "position": {
        "x": 455,
        "y": 136.33333333333331
      },
      "data": {
        "descriptionFile": "data>getCountryPolygon.yml"
      }
    },
    {
      "id": "48",
      "type": "userInput",
      "position": {
        "x": 12,
        "y": 168.33333333333331
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text",
        "value": "EPSG:4326"
      }
    },
    {
      "id": "49",
      "type": "io",
      "position": {
        "x": 1095,
        "y": 210.33333333333331
      },
      "data": {
        "descriptionFile": "data>getBoundingBox.yml"
      }
    },
    {
      "id": "50",
      "type": "output",
      "position": {
        "x": 2174.0784636685935,
        "y": 263.63724807968634
      },
      "data": {
        "label": "Output"
      }
    },
    {
      "id": "51",
      "type": "constant",
      "position": {
        "x": 897.7004700169571,
        "y": 396.8832204578773
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "application/geopackage+sqlite3"
      }
    },
    {
      "id": "52",
      "type": "constant",
      "position": {
        "x": 1225.6000061035156,
        "y": 341.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "options",
        "value": "near",
        "options": [
          "near",
          "bilinear",
          "average",
          "mode",
          "cubic",
          "cubicspline",
          "lanczos",
          "rms",
          "min",
          "max",
          "sum",
          "med",
          "q1",
          "q3"
        ]
      }
    },
    {
      "id": "53",
      "type": "constant",
      "position": {
        "x": 1235.6000061035156,
        "y": 378.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "options",
        "value": "first",
        "options": [
          "first",
          "min",
          "max",
          "mean",
          "median"
        ]
      }
    },
    {
      "id": "54",
      "type": "constant",
      "position": {
        "x": 1225.6000061035156,
        "y": 310.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "float",
        "value": 1000
      }
    },
    {
      "id": "55",
      "type": "constant",
      "position": {
        "x": 1268.6000061035156,
        "y": 318.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text"
      }
    },
    {
      "id": "56",
      "type": "constant",
      "position": {
        "x": 1273.6000061035156,
        "y": 282.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text",
        "value": null
      }
    },
    {
      "id": "58",
      "type": "constant",
      "position": {
        "x": 1278.6000061035156,
        "y": 257.7999954223633
      },
      "dragHandle": ".dragHandle",
      "data": {
        "type": "text",
        "value": "https://stac.geobon.org/"
      }
    }
  ],
  "edges": [
    {
      "source": "2",
      "sourceHandle": "rasters",
      "target": "0",
      "targetHandle": "rasters",
      "id": "reactflow__edge-2rasters-0rasters"
    },
    {
      "source": "0",
      "sourceHandle": "rast_blocks",
      "target": "6",
      "targetHandle": null,
      "id": "reactflow__edge-0rast_blocks-6"
    },
    {
      "source": "0",
      "sourceHandle": "pca_summary_df",
      "target": "13",
      "targetHandle": null,
      "id": "reactflow__edge-0pca_summary_df-13"
    },
    {
      "source": "0",
      "sourceHandle": "blocks_plot",
      "target": "14",
      "targetHandle": null,
      "id": "reactflow__edge-0blocks_plot-14"
    },
    {
      "source": "26",
      "sourceHandle": "pts_df",
      "target": "29",
      "targetHandle": null,
      "id": "reactflow__edge-26pts_df-29"
    },
    {
      "source": "0",
      "sourceHandle": "rast_blocks",
      "target": "26",
      "targetHandle": "rast_blocks",
      "id": "reactflow__edge-0rast_blocks-26rast_blocks"
    },
    {
      "source": "26",
      "sourceHandle": "maps_output",
      "target": "31",
      "targetHandle": null,
      "id": "reactflow__edge-26maps_output-31"
    },
    {
      "source": "26",
      "sourceHandle": "points_shape",
      "target": "32",
      "targetHandle": null,
      "id": "reactflow__edge-26points_shape-32"
    },
    {
      "source": "0",
      "sourceHandle": "colors_vect",
      "target": "26",
      "targetHandle": "colors_vect",
      "id": "reactflow__edge-0colors_vect-26colors_vect"
    },
    {
      "source": "48",
      "sourceHandle": null,
      "target": "45",
      "targetHandle": "crs",
      "id": "reactflow__edge-48-45crs"
    },
    {
      "source": "48",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "crs",
      "id": "reactflow__edge-48-2crs"
    },
    {
      "source": "45",
      "sourceHandle": "country_region_polygon",
      "target": "49",
      "targetHandle": "study_area_file",
      "id": "reactflow__edge-45country_region_polygon-49study_area_file"
    },
    {
      "source": "48",
      "sourceHandle": null,
      "target": "49",
      "targetHandle": "crs",
      "id": "reactflow__edge-48-49crs"
    },
    {
      "source": "49",
      "sourceHandle": "bbox",
      "target": "2",
      "targetHandle": "bbox",
      "id": "reactflow__edge-49bbox-2bbox"
    },
    {
      "source": "45",
      "sourceHandle": "country_region_polygon",
      "target": "0",
      "targetHandle": "country_polygon",
      "id": "reactflow__edge-45country_region_polygon-0country_polygon"
    },
    {
      "source": "45",
      "sourceHandle": "country_region_polygon",
      "target": "26",
      "targetHandle": "country_polygon",
      "id": "reactflow__edge-45country_region_polygon-26country_polygon"
    },
    {
      "source": "2",
      "sourceHandle": "rasters",
      "target": "50",
      "targetHandle": null,
      "id": "reactflow__edge-2rasters-50"
    },
    {
      "source": "51",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "study_area",
      "id": "reactflow__edge-51-2study_area"
    },
    {
      "source": "52",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "resampling",
      "id": "reactflow__edge-52-2resampling"
    },
    {
      "source": "53",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "aggregation",
      "id": "reactflow__edge-53-2aggregation"
    },
    {
      "source": "54",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "spatial_res",
      "id": "reactflow__edge-54-2spatial_res"
    },
    {
      "source": "55",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "t1",
      "id": "reactflow__edge-55-2t1"
    },
    {
      "source": "56",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "t0",
      "id": "reactflow__edge-56-2t0"
    },
    {
      "source": "58",
      "sourceHandle": null,
      "target": "2",
      "targetHandle": "stac_url",
      "id": "reactflow__edge-58-2stac_url"
    }
  ],
  "inputs": {
    "data>getCountryPolygon.yml@45|region": {
      "description": "State/Province name in the native language of the region",
      "label": "State/Province name",
      "type": "text",
      "example": null,
      "weight": 0
    },
    "site_selection_BAS>BAS_algorithm.yml@26|options_bas": {
      "description": "Select and option between equal BAS or unequal probability BAS. \"Equal\" will not consider the blocks and place all sampling randomly in the whole study area.  \"Unequal\" will take into account the size of the each environmental block and redistribute the sampling sites based on the size of block.  ",
      "label": "Sampling type",
      "type": "options",
      "options": [
        "equal",
        "unequal"
      ],
      "example": "equal",
      "weight": 1
    },
    "site_selection_BAS>BAS_algorithm.yml@26|ndesign": {
      "description": "A number of target sampling sites to obtain with the algorithm",
      "label": "Target total sites",
      "type": "int",
      "example": 100,
      "weight": 2
    },
    "site_selection_BAS>Block_creation.yml@0|n_cols": {
      "description": "Number of columns for the environmental space grid (together with rows will define the final number of environmental blocks)",
      "label": "Number of columns",
      "type": "int",
      "example": 10,
      "weight": 3
    },
    "site_selection_BAS>Block_creation.yml@0|n_rows": {
      "description": "Number of rows for the environmental space grid (together with columns will define the final number environmental blocks)",
      "label": "Number of rows",
      "type": "int",
      "example": 10,
      "weight": 4
    },
    "pipeline@48": {
      "label": "Coordinate reference system",
      "description": "This input specifies the coordinate reference system of the country polygon output.\n\nThe numerical value refers to the EPSG code (European Petroleum Survey Group) associated with the spatial reference system that will be used as a reference for the study area.\nThis numerical value specifies the projection and geodetic datum used to define the coordinates and spatial representation of the data in the study area.\n\nFor further information on coordinate systems and EPSG codes, you can access the official database on the EPSG website at [https://epsg.org/home.html](https://epsg.org/home.html).\nThe website provides documentation, resources, and tools for searching and understanding the EPSG codes used in various geospatial contexts.\n",
      "type": "text",
      "example": "EPSG:5387",
      "weight": 5
    },
    "data>loadFromStac.yml@2|temporal_res": {
      "description": "Temporal resolution to use when querying STAC items by date, in the format (\"P\", time interval, and time unit, e.g. \"P1Y\" is yearly, \"P1M\" is montly, and \"P1D\" is daily). Leave blank if not querying by date. If the temporal resolution is coarser than the temporal resolution of the time series, the layers will be aggregated with the aggregation method chosen below.",
      "label": "Temporal resolution",
      "type": "text",
      "example": null,
      "weight": 6
    },
    "data>loadFromStac.yml@2|collections_items": {
      "description": "Set of environmental variables to use  (e.g. for temperature \"chelsa-clim|bio1\", precipitation \"chelsa-clim|bio12\"), on which to run the PCA (a minimum of 2 variables are needed)",
      "label": "Environmental variables (STAC collection items)",
      "type": "text[]",
      "example": [
        "chelsa-clim|bio1",
        "chelsa-clim|bio2"
      ],
      "weight": 7
    },
    "data>getCountryPolygon.yml@45|country": {
      "description": "ISO3 country code for the country of interest. For a list of ISO3 country codes,\nlook [here](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes).\n",
      "label": "ISO3 country code",
      "type": "text",
      "example": "COL",
      "weight": 8
    }
  },
  "outputs": {
    "site_selection_BAS>Block_creation.yml@0|rast_blocks": {
      "description": "Raster file of the study area with the environmental blocks as categorical classes  ",
      "label": "Environmental blocks raster",
      "type": "image/tiff;application=geotiff[]",
      "weight": 0
    },
    "site_selection_BAS>Block_creation.yml@0|pca_summary_df": {
      "description": "Principal component analysis summary for the environmental variables included in the analysis",
      "label": "Summary of PCA",
      "type": "csv",
      "weight": 1
    },
    "site_selection_BAS>Block_creation.yml@0|blocks_plot": {
      "description": "Blocks showing the PCA 1 and 2 result and the predefined blocks dividing the environmental space and the map of the environmental blocks in geographic space",
      "label": "Blocks and map plots",
      "type": "image/png",
      "weight": 2
    },
    "site_selection_BAS>BAS_algorithm.yml@26|pts_df": {
      "description": "Dataframe of selected sampling points using the BAS algorithm",
      "label": "Selected sampling points",
      "type": "csv",
      "weight": 3
    },
    "site_selection_BAS>BAS_algorithm.yml@26|maps_output": {
      "description": "Maps of study area with selected sampling points only (no environmental blocks) and also including the environmental blocks.",
      "label": "Maps output",
      "type": "image/png",
      "weight": 4
    },
    "site_selection_BAS>BAS_algorithm.yml@26|points_shape": {
      "description": "Vector shapefile of selected sampling points",
      "label": "Selected sampling points shapefile",
      "type": "application/geo+json",
      "weight": 5
    },
    "data>loadFromStac.yml@2|rasters": {
      "description": "Array of environmental rasters (for exploration only)",
      "label": "Environmental Rasters",
      "type": "image/tiff;application=geotiff[]",
      "weight": 6
    }
  },
  "metadata": {
    "name": "Environmental Sampling Site Selection",
    "description": "## Introduction\nBiodiversity monitoring often requires researchers to draw samples of different population due to limitation of budget, time, and accesibility. Many methods exist to produce samples from a continous surface, but balanced sampling has proven to be one of the most efficient in capturing patterns  in different populations. Tools that allow for quick and robust sampling frameworks provide researchers with strong sampling designs to address multiple ecological questions. Here we present a method that  uses balanced acceptance sampling to select sampling site in a defined area.    \n## Uses\nSelection of sampling sites using a BAS algorithm with two different approches (equal  and unequal sampling distribution). The pipeline produces environmental blocks and can  use those to generate an unequal sampling   distribution.  Blocks are based on PCA performed on the selected environmental   variables or can use only 2 raw environmental  variables. The user should  define the grid size  for the block generation and a target  sample size that will be assigned using a randomly balanced design, taking into account the inclusion probability of each block  which is  proportional to their area, if the option \"unequeal\" is selected. \n## Limitations \nCurrently the pipeline only works for a defined geopolitical outline (e.g. country,  or province) defined in the STAC Catalog. Unequal sampling may produce unexpected results in the balanced appproach. \n## Before you start\nDefine a projected CRS for your study area\n ",
    "author": [
      {
        "name": "Francis van Oordt",
        "email": "francis.vanoordtlahoz@mail.mcgill.ca",
        "identifier": "https://orcid.org/0000-0002-8471-235X"
      }
    ],
    "license": "CC-BY",
    "references": [
      {
        "text": "spbal: Spatially Balanced Sampling Algorithms",
        "doi": "10.32614/CRAN.package.spbal"
      },
      {
        "text": "Survey-gap analysis in expeditionary research: where do we go from here?",
        "doi": "https://doi.org/10.1111/j.1095-8312.2005.00520.x"
      },
      {
        "text": "Selection of sampling sites for biodiversity inventory: Effects of environmental and geographical considerations",
        "doi": "https://doi.org/10.1111/2041-210X.13869"
      }
    ]
  }
}