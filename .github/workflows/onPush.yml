name: On push, any branch

on: [push]
# TODO change pipeline-repo-actions to main
jobs:
  run-yml-validation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Getting init script
      working-directory: .
      run: git clone -n git@github.com:GEO-BON/bon-in-a-box-pipeline-engine.git --branch pipeline-repo-actions --single-branch .server --depth 1; \
           cd .server; \
           git checkout origin/pipeline-repo-actions -- prod-server.sh
      shell: bash
    - name: Getting server config
      working-directory: .
      run: $GITHUB_WORKSPACE/.server/.prod-server.sh checkout pipeline-repo-actions
      shell: bash
    - name: Script and pipelines basic validation
      working-directory: .
      run: $GITHUB_WORKSPACE/.server/.prod-server.sh validate
      shell: bash